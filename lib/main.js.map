{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/main.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'DBAY-CMUDICT'\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\ninfo                      = CND.get_logger 'info',      badge\nurge                      = CND.get_logger 'urge',      badge\nhelp                      = CND.get_logger 'help',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\necho                      = CND.echo.bind CND\n#...........................................................................................................\nPATH                      = require 'path'\ntypes                     = require './types'\n{ isa\n  type_of\n  validate\n  validate_list_of }      = types.export()\nSQL                       = String.raw\nguy                       = require 'guy'\n\n\n#===========================================================================================================\nclass @Cmud\n\n  #---------------------------------------------------------------------------------------------------------\n  @C: guy.lft.freeze\n    defaults:\n      #.....................................................................................................\n      constructor_cfg:\n        db:           null\n        prefix:       'cmud_'\n        schema:       'cmud'\n        path:         PATH.resolve PATH.join __dirname, '../cmudict.sqlite'\n        source_path:  PATH.resolve PATH.join __dirname, '../cmudict-0.7b'\n        abipa_path:   PATH.resolve PATH.join __dirname, '../arpabet-to-ipa.tsv'\n        xsipa_path:   PATH.resolve PATH.join __dirname, '../xsampa-to-ipa.tsv'\n        create:       false\n\n  #---------------------------------------------------------------------------------------------------------\n  @cast_constructor_cfg: ( me, cfg = null ) ->\n    clasz           = me.constructor\n    R               = cfg ? me.cfg\n    # #.......................................................................................................\n    # if R.path?\n    #   R.temporary  ?= false\n    #   R.path        = PATH.resolve R.path\n    # else\n    #   R.temporary  ?= true\n    #   filename        = me._get_random_filename()\n    #   R.path        = PATH.resolve PATH.join clasz.C.autolocation, filename\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  @declare_types: ( me ) ->\n    ### called from constructor via `guy.cfg.configure_with_types()` ###\n    me.cfg        = @cast_constructor_cfg me\n    me.types.validate.constructor_cfg me.cfg\n    { db, }       = guy.obj.pluck_with_fallback me.cfg, null, 'db'\n    guy.props.def me, 'db', { enumerable: false, value: db, }\n    me.cfg        = guy.lft.freeze guy.obj.omit_nullish me.cfg\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( cfg ) ->\n    guy.cfg.configure_with_types @, cfg, types\n    @_compile_sql()\n    @_create_sql_functions()\n    @_open_cmu_db()\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  _create_db_structure: ->\n    { prefix\n      schema } = @cfg\n    @db.execute SQL\"\"\"\n      drop index if exists #{schema}.entries_word_idx;\n      drop index if exists #{schema}.entries_arpabet_idx;\n      drop index if exists #{schema}.entries_xsampa_idx;\n      drop index if exists #{schema}.entries_ipa_idx;\n      drop table if exists #{schema}.entries;\n      drop table if exists #{schema}.abipa;\n      drop table if exists #{schema}.xsipa;\n      -- ...................................................................................................\n      create table #{schema}.entries (\n          id        integer not null primary key,\n          word      text    not null,\n          arpabet_s text    not null,\n          arpabet   text    not null,\n          xsampa    text    not null,\n          ipa       text    not null );\n      create index #{schema}.entries_word_idx\n        on entries ( word );\n      create index #{schema}.entries_arpabet_idx\n        on entries ( arpabet );\n      create index #{schema}.entries_xsampa_idx\n        on entries ( xsampa );\n      create index #{schema}.entries_ipa_idx\n        on entries ( ipa );\n      create table #{schema}.abipa (\n        cv          text    not null,\n        ab1         text,\n        ab2         text    not null primary key,\n        ipa         text    not null,\n        example     text    not null );\n      create table #{schema}.xsipa (\n        description text,\n        xs          text    not null primary key,\n        ipa         text    not null,\n        example     text    not null );\n      \"\"\"\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _compile_sql: ->\n    { prefix\n      schema }  = @cfg\n    sql         =\n      get_db_object_count:  SQL\"select count(*) as count from #{schema}.sqlite_schema;\"\n      truncate_entries:     SQL\"delete from #{schema}.entries;\"\n      truncate_abipa:       SQL\"delete from #{schema}.abipa;\"\n      truncate_xsipa:       SQL\"delete from #{schema}.xsipa;\"\n      insert_entry: SQL\"\"\"\n        insert into #{schema}.entries ( word, arpabet_s, arpabet, xsampa, ipa )\n          values ( $word, $arpabet_s, $arpabet, $xsampa, $ipa );\"\"\"\n      insert_abipa: SQL\"\"\"\n        insert into #{schema}.abipa ( cv, ab1, ab2, ipa, example )\n          values ( $cv, $ab1, $ab2, $ipa, $example );\"\"\"\n      insert_xsipa: SQL\"\"\"\n        insert into #{schema}.xsipa ( description, xs, ipa, example )\n          values ( $description, $xs, $ipa, $example );\"\"\"\n    guy.props.def @, 'sql', { enumerable: false, value: sql, }\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _create_sql_functions: ->\n    { prefix\n      schema } = @cfg\n    # #.......................................................................................................\n    # @dba.create_function\n    #   name:           \"#{prefix}_tags_from_id\",\n    #   deterministic:  true,\n    #   varargs:        false,\n    #   call:           ( id ) =>\n    #     fallbacks = @get_filtered_fallbacks()\n    #     tagchain  = @tagchain_from_id { id, }\n    #     tags      = @tags_from_tagchain { tagchain, }\n    #     return JSON.stringify { fallbacks..., tags..., }\n    #.......................................................................................................\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _get_db_object_count: -> @db.single_value @sql.get_db_object_count\n  _truncate_entries:    -> @db @sql.truncate_entries\n  _truncate_abipa:      -> @db @sql.truncate_abipa\n  _truncate_xsipa:      -> @db @sql.truncate_xsipa\n\n  #---------------------------------------------------------------------------------------------------------\n  _open_cmu_db: ->\n    @db.open @cfg\n    if @cfg.create or ( @_get_db_object_count() is 0 )\n      @_create_db_structure()\n      @_populate_db()\n    else\n      null\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _populate_db: ->\n    @_populate_arpabet_to_ipa()\n    @_populate_xsampa_to_ipa()\n    @_populate_entries()\n\n  #---------------------------------------------------------------------------------------------------------\n  _populate_entries: ->\n    count = 0\n    @_truncate_entries()\n    insert = @db.prepare @sql.insert_entry\n    @db =>\n      for line from guy.fs.walk_lines @cfg.source_path\n        continue if line.startsWith ';;;'\n        line                  = line.trimEnd()\n        [ word, arpabet_s,  ] = line.split '\\x20\\x20'\n        word                  = word.trim()\n        arpabet_s             = arpabet_s.trim()\n        continue if ( word.endsWith \"'S\" ) or ( word.endsWith \"'\" )\n        continue if ( word.match /'S\\(\\d\\)$/ )?\n        unless word? and word.length > 0 and arpabet_s? and arpabet_s.length > 0\n          warn '^4443^', count, ( rpr line )\n          continue\n        #...................................................................................................\n        count++\n        word      = word.toLowerCase()\n        arpabet_s = arpabet_s.toLowerCase()\n        arpabet   = arpabet_s.replace /\\s+/g, ''\n        ipa       = @ipa_from_arpabet_s arpabet_s\n        xsampa    = @xsampa_from_ipa    ipa\n        insert.run { word, arpabet_s, arpabet, xsampa, ipa, }\n      return null\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _populate_arpabet_to_ipa: ->\n    @_truncate_abipa()\n    line_nr     = 0\n    ipa_by_ab2  = {}\n    insert      = @db.prepare @sql.insert_abipa\n    @db =>\n      for line from guy.fs.walk_lines @cfg.abipa_path\n        line_nr++\n        line              = line.trim()\n        continue if line.length is 0\n        continue if line.startsWith '#'\n        fields            = line.split '\\t'\n        fields[ idx ]     = field.trim() for field, idx in fields\n        fields[ idx ]     = null for field, idx in fields when field is 'N/A'\n        [ cv\n          ab1\n          ab2\n          ipa\n          example ]       = fields\n        ab1               = ab1.toLowerCase() if ab1\n        ab2               = ab2.toLowerCase()\n        example           = example.replace /\\x20/g, ''\n        ipa_by_ab2[ ab2 ] = ipa\n        insert.run { cv, ab1, ab2, ipa, example, }\n      return null\n    ipa_by_ab2 = guy.lft.freeze ipa_by_ab2\n    guy.props.def @, 'ipa_by_ab2', { enumerable: false, value: ipa_by_ab2, }\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _undoublequote: ( text ) ->\n    return text unless text[ 0                          ] is '\"'\n    return text unless text[ last_idx = text.length - 1 ] is '\"'\n    return text[ 1 ... last_idx ]\n\n  #---------------------------------------------------------------------------------------------------------\n  _populate_xsampa_to_ipa: ->\n    @_truncate_xsipa()\n    line_nr     = 0\n    xs_by_ipa   = {}\n    insert      = @db.prepare @sql.insert_xsipa\n    @db =>\n      for line from guy.fs.walk_lines @cfg.xsipa_path\n        line_nr++\n        line              = line.trim()\n        continue if line.length is 0\n        continue if line.startsWith '#'\n        fields            = line.split '\\t'\n        fields[ idx ]     = field.trim() for field, idx in fields\n        # fields[ idx ]     = null for field, idx in fields when field is 'N/A'\n        [ xs\n          ipa\n          _\n          description\n          example ]       = fields\n        example          ?= \"(no example)\"\n        example           = @_undoublequote example\n        example           = example.replace /\\\\\"/g, '\"'\n        xs_by_ipa[ ipa ]  = xs\n        insert.run { description, xs, ipa, example, }\n      return null\n    xs_by_ipa = guy.lft.freeze xs_by_ipa\n    guy.props.def @, 'xs_by_ipa', { enumerable: false, value: xs_by_ipa, }\n    return null\n\n  #=========================================================================================================\n  #\n  #---------------------------------------------------------------------------------------------------------\n  # ipa_from_arpabet_s_1: ( arpabet_s ) ->\n  #   R = arpabet_s.replace /\\b[\\S]+?\\b/g, ( match ) =>\n  #     match = match.replace /\\d+$/, ''\n  #     return @ipa_by_ab2[ match ] ? '?'\n  #   return R.replace /\\s/g, ''\n\n  #---------------------------------------------------------------------------------------------------------\n  ipa_from_arpabet_s: ( arpabet_s ) ->\n    R = arpabet_s.split '\\x20'\n    return ( @ipa_by_ab2[ ( phone.replace /\\d+$/, '' ) ] ? '█' for phone in R ).join ''\n\n  #---------------------------------------------------------------------------------------------------------\n  xsampa_from_ipa: ( ipa ) ->\n    R = Array.from ipa\n    return ( @xs_by_ipa[ letter ] ? '█' for letter, idx in R ).join ''\n\n\n\n"
  ]
}